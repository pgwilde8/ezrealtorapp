<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if agent %}{{ agent.name }} - Real Estate Professional{% else %}Real Estate Agent{% endif %}</title>
    <meta name="description" content="{% if agent %}{{ agent.name }} - {{ agent.title or 'Real Estate Professional' }}. {{ agent.bio[:150] if agent.bio else 'Helping buyers and sellers achieve their real estate goals.' }}{% endif %}">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #1a1a1a;
        }
        
        /* Hero Section */
        .hero {
            background: {% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}linear-gradient(135deg, #667eea 0%, #764ba2 100%){% endif %};
            color: white;
            padding: 80px 20px;
            text-align: center;
            position: relative;
        }
        
        .hero-content {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .agent-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid white;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin: 0 auto 25px;
        }
        
        .hero h1 {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 10px;
        }
        
        .hero .title {
            font-size: 24px;
            opacity: 0.95;
            margin-bottom: 30px;
        }
        
        .cta-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        
        .btn {
            padding: 16px 32px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .btn-primary {
            background: white;
            color: {% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}#667eea{% endif %};
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
        }
        
        /* Contact Bar */
        .contact-bar {
            background: rgba(255,255,255,0.15);
            padding: 15px 20px;
            margin-top: 40px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .contact-item {
            color: white;
            text-decoration: none;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Section Styles */
        .section {
            padding: 80px 20px;
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .section-title {
            font-size: 36px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 50px;
            color: #1a1a1a;
        }
        
        /* Services Grid */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .service-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.3s;
            cursor: pointer;
        }
        
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }
        
        .service-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .service-card h3 {
            font-size: 22px;
            margin-bottom: 10px;
            color: #1a1a1a;
        }
        
        .service-card p {
            color: #666;
            margin-bottom: 20px;
        }
        
        .service-card a {
            color: {% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}#667eea{% endif %};
            text-decoration: none;
            font-weight: 600;
        }
        
        /* About Section */
        .about {
            background: #f9fafb;
        }
        
        .about-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 50px;
            align-items: center;
        }
        
        .about-photo {
            width: 100%;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .about-text h2 {
            font-size: 32px;
            margin-bottom: 20px;
            color: #1a1a1a;
        }
        
        .about-text p {
            color: #666;
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 15px;
        }
        
        .credentials {
            margin-top: 25px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .credential-badge {
            background: {% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}#667eea{% endif %};
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            text-align: center;
            padding: 60px 20px;
            background: white;
        }
        
        .stat-number {
            font-size: 48px;
            font-weight: 700;
            color: {% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}#667eea{% endif %};
            display: block;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        /* Social Proof */
        .testimonials {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .testimonial {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .stars {
            color: #fbbf24;
            font-size: 20px;
            margin-bottom: 15px;
        }
        
        .testimonial-text {
            color: #374151;
            font-style: italic;
            margin-bottom: 15px;
            line-height: 1.7;
        }
        
        .testimonial-author {
            font-weight: 600;
            color: #1a1a1a;
        }
        
        /* Footer */
        .footer {
            background: #1f2937;
            color: #9ca3af;
            padding: 50px 20px 30px;
            text-align: center;
        }
        
        .footer-content {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .social-link {
            width: 50px;
            height: 50px;
            background: #374151;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            font-size: 20px;
            transition: background 0.3s;
        }
        
        .social-link:hover {
            background: {% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}#667eea{% endif %};
        }
        
        .footer p {
            font-size: 13px;
            line-height: 1.8;
            margin-bottom: 10px;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .hero h1 { font-size: 36px; }
            .hero .title { font-size: 18px; }
            .about-content { grid-template-columns: 1fr; }
            .cta-buttons { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    
    <!-- Hero Section -->
    <div class="hero">
        <div class="hero-content">
            {% if agent and agent.headshot_url %}
            <img src="{{ agent.headshot_url }}" alt="{{ agent.name }}" class="agent-photo">
            {% else %}
            <div style="width: 150px; height: 150px; border-radius: 50%; background: rgba(255,255,255,0.2); margin: 0 auto 25px; display: flex; align-items: center; justify-content: center; font-size: 64px;">
                üë§
            </div>
            {% endif %}
            
            <h1>{% if agent %}{{ agent.name }}{% else %}Your Real Estate Expert{% endif %}</h1>
            <p class="title">
                {% if agent and agent.title %}{{ agent.title }}{% else %}Real Estate Professional{% endif %}
                {% if agent and agent.brokerage_name %} ‚Ä¢ {{ agent.brokerage_name }}{% endif %}
            </p>
            
            <p style="font-size: 20px; margin: 20px auto; max-width: 600px; opacity: 0.95;">
                {% if agent and agent.tagline %}
                    {{ agent.tagline }}
                {% else %}
                    Helping buyers and sellers achieve their real estate goals with personalized service and local expertise
                {% endif %}
            </p>
            
            <div class="cta-buttons">
                <a href="/lead-home-value" class="btn btn-primary">
                    üí∞ What's My Home Worth?
                </a>
                <a href="/lead-buyer" class="btn btn-secondary">
                    üè° Find My Dream Home
                </a>
                <button onclick="openContactModal()" class="btn btn-secondary">
                    üìß Contact Me
                </button>
            </div>
            
            <div class="contact-bar">
                {% if agent and agent.phone %}
                <a href="tel:{{ agent.phone }}" class="contact-item">
                    üìû {{ agent.phone }}
                </a>
                {% endif %}
                {% if agent and agent.public_email %}
                <a href="mailto:{{ agent.public_email }}" class="contact-item">
                    üìß Email Me
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Stats Bar -->
    {% if agent and (agent.years_experience or agent.sales_volume or agent.total_transactions) %}
    <div class="stats-bar">
        {% if agent.years_experience %}
        <div>
            <span class="stat-number">{{ agent.years_experience }}+</span>
            <span class="stat-label">Years Experience</span>
        </div>
        {% endif %}
        {% if agent.sales_volume %}
        <div>
            <span class="stat-number">${{ (agent.sales_volume / 1000000)|int }}M+</span>
            <span class="stat-label">Total Sales Volume</span>
        </div>
        {% endif %}
        {% if agent.total_transactions %}
        <div>
            <span class="stat-number">{{ agent.total_transactions }}+</span>
            <span class="stat-label">Happy Clients</span>
        </div>
        {% endif %}
        <div>
            <span class="stat-number">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
            <span class="stat-label">5-Star Rated</span>
        </div>
    </div>
    {% endif %}

    <!-- About Section -->
    <div class="section about">
        <div class="about-content">
            <div>
                {% if agent and agent.secondary_photo_url %}
                <img src="{{ agent.secondary_photo_url }}" alt="{{ agent.name }}" class="about-photo">
                {% else %}
                <div style="width: 100%; height: 300px; background: #e5e7eb; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 48px; color: #9ca3af;">
                    üè†
                </div>
                {% endif %}
            </div>
            <div class="about-text">
                <h2>About {% if agent %}{{ agent.name.split()[0] }}{% else %}Me{% endif %}</h2>
                <p>
                    {% if agent and agent.bio %}
                        {{ agent.bio }}
                    {% else %}
                        As a dedicated real estate professional, I'm committed to helping you navigate the buying and selling process with confidence. With years of local market expertise and a passion for matching people with their perfect homes, I provide personalized service tailored to your unique needs.
                        
                        Whether you're a first-time buyer, experienced investor, or looking to sell your property, I'll guide you through every step of the journey with professionalism and care.
                    {% endif %}
                </p>
                
                {% if agent and (agent.license_number or agent.brokerage_name) %}
                <div class="credentials">
                    {% if agent.license_number %}
                    <span class="credential-badge">License #{{ agent.license_number }}</span>
                    {% endif %}
                    {% if agent.brokerage_name %}
                    <span class="credential-badge">{{ agent.brokerage_name }}</span>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Services Section -->
    <div class="section">
        <h2 class="section-title">How I Can Help You</h2>
        <div class="services-grid">
            <div class="service-card" onclick="window.location.href='/lead-buyer'">
                <div class="service-icon">üè†</div>
                <h3>Buyer Services</h3>
                <p>Find your perfect home with personalized property matches and expert negotiation</p>
                <a href="/lead-buyer">Start Your Search ‚Üí</a>
            </div>
            
            <div class="service-card" onclick="window.location.href='/lead-home-value'">
                <div class="service-icon">üí∞</div>
                <h3>Seller Services</h3>
                <p>Get top dollar for your home with strategic pricing and marketing</p>
                <a href="/lead-home-value">Get Free Home Value ‚Üí</a>
            </div>
            
            <div class="service-card" onclick="window.location.href='/whats-my-rate'">
                <div class="service-icon">üìä</div>
                <h3>Mortgage Calculator</h3>
                <p>Calculate your monthly payment with today's rates</p>
                <a href="/whats-my-rate">Calculate Payment ‚Üí</a>
            </div>
        </div>
    </div>

    <!-- Testimonials Section -->
    <div class="section" style="background: #f9fafb;">
        <h2 class="section-title">What Clients Say</h2>
        <div class="testimonials">
            <div class="testimonial">
                <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                <p class="testimonial-text">
                    "{% if agent %}{{ agent.name }}{% else %}Our agent{% endif %} made the home buying process so smooth! Found us the perfect home in just 2 weeks and negotiated a great price."
                </p>
                <p class="testimonial-author">‚Äî Sarah & Mike T.</p>
            </div>
            
            <div class="testimonial">
                <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                <p class="testimonial-text">
                    "Sold our home for $35K over asking! Professional, responsive, and really understood our local market. Highly recommended!"
                </p>
                <p class="testimonial-author">‚Äî Jennifer L.</p>
            </div>
            
            <div class="testimonial">
                <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                <p class="testimonial-text">
                    "As a first-time buyer, I had lots of questions. {% if agent %}{{ agent.name.split()[0] }}{% else %}My agent{% endif %} was patient, knowledgeable, and made sure I felt confident every step of the way."
                </p>
                <p class="testimonial-author">‚Äî Marcus R.</p>
            </div>
        </div>
    </div>

    <!-- CTA Section -->
    <div class="section" style="background: {% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}linear-gradient(135deg, #667eea 0%, #764ba2 100%){% endif %}; color: white; text-align: center;">
        <h2 style="font-size: 42px; margin-bottom: 20px; color: white;">Ready to Get Started?</h2>
        <p style="font-size: 20px; margin-bottom: 40px; opacity: 0.95;">Let's discuss your real estate goals</p>
        
        <div class="cta-buttons">
            {% if agent and agent.phone %}
            <a href="tel:{{ agent.phone }}" class="btn btn-primary">
                üìû Call Now
            </a>
            {% endif %}
            <button onclick="openContactModal()" class="btn btn-secondary">
                üìß Send a Message
            </button>
            <a href="/listing-alerts" class="btn btn-secondary">
                üîî Get Property Alerts
            </a>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-content">
            {% if agent and agent.logo_url %}
            <img src="{{ agent.logo_url }}" alt="{{ agent.name }}" style="height: 40px; margin: 0 auto 20px;">
            {% endif %}
            
            <p style="font-size: 16px; font-weight: 600; color: #d1d5db;">
                {% if agent %}{{ agent.name }}{% else %}Real Estate Professional{% endif %}
            </p>
            
            {% if agent %}
            <p>
                {% if agent.title %}{{ agent.title }}<br>{% endif %}
                {% if agent.brokerage_name %}{{ agent.brokerage_name }}<br>{% endif %}
                {% if agent.license_number %}License #{{ agent.license_number }}<br>{% endif %}
                {% if agent.office_address %}{{ agent.office_address }}{% endif %}
            </p>
            {% endif %}
            
            {% if agent and (agent.facebook_url or agent.instagram_url or agent.linkedin_url or agent.youtube_url) %}
            <div class="social-links">
                {% if agent.facebook_url %}
                <a href="{{ agent.facebook_url }}" target="_blank" class="social-link" title="Facebook">
                    <i class="fab fa-facebook-f"></i>
                </a>
                {% endif %}
                {% if agent.instagram_url %}
                <a href="{{ agent.instagram_url }}" target="_blank" class="social-link" title="Instagram">
                    <i class="fab fa-instagram"></i>
                </a>
                {% endif %}
                {% if agent.linkedin_url %}
                <a href="{{ agent.linkedin_url }}" target="_blank" class="social-link" title="LinkedIn">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                {% endif %}
                {% if agent.youtube_url %}
                <a href="{{ agent.youtube_url }}" target="_blank" class="social-link" title="YouTube">
                    <i class="fab fa-youtube"></i>
                </a>
                {% endif %}
            </div>
            {% endif %}
            
            <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #374151;">
                <p style="font-size: 11px; max-width: 800px; margin: 0 auto;">
                    <strong>Fair Housing Notice:</strong> We are pledged to the letter and spirit of U.S. policy for the achievement of equal housing opportunity. We encourage and support an affirmative advertising and marketing program in which there are no barriers to obtaining housing because of race, color, religion, sex, handicap, familial status, or national origin.
                </p>
                <p style="margin-top: 20px; font-size: 12px;">
                    ¬© {% if agent %}{{ agent.name }}{% else %}Real Estate Professional{% endif %} 2025 ‚Ä¢ All Rights Reserved
                </p>
            </div>
        </div>
    </div>

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Contact Form Modal -->
    <div id="contactModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 16px; padding: 40px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; position: relative; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <!-- Close Button -->
            <button onclick="closeContactModal()" style="position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 28px; color: #9ca3af; cursor: pointer; line-height: 1; padding: 0;">√ó</button>
            
            <!-- Header -->
            <div style="text-align: center; margin-bottom: 30px;">
                {% if agent and agent.headshot_url %}
                <img src="{{ agent.headshot_url }}" alt="{{ agent.name }}" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 15px; border: 3px solid {% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}#667eea{% endif %};">
                {% else %}
                <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 40px;">üë§</div>
                {% endif %}
                <h2 style="font-size: 28px; font-weight: 700; color: #1a1a1a; margin-bottom: 8px;">Get in Touch</h2>
                <p style="color: #666; font-size: 16px;">{% if agent %}{{ agent.name }}{% else %}I{% endif %} will respond within 24 hours</p>
            </div>
            
            <!-- Contact Form -->
            <form id="contactForm" onsubmit="submitContactForm(event)">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 14px;">Your Name *</label>
                    <input type="text" id="contact_name" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 15px; transition: border-color 0.2s;" onfocus="this.style.borderColor='{% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}#667eea{% endif %}'" onblur="this.style.borderColor='#e5e7eb'">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 14px;">Email Address *</label>
                    <input type="email" id="contact_email" required style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 15px; transition: border-color 0.2s;" onfocus="this.style.borderColor='{% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}#667eea{% endif %}'" onblur="this.style.borderColor='#e5e7eb'">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 14px;">Phone Number</label>
                    <input type="tel" id="contact_phone" placeholder="(555) 123-4567" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 15px; transition: border-color 0.2s;" onfocus="this.style.borderColor='{% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}#667eea{% endif %}'" onblur="this.style.borderColor='#e5e7eb'">
                </div>
                
                <div style="margin-bottom: 25px;">
                    <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 14px;">Message *</label>
                    <textarea id="contact_message" required rows="5" placeholder="Tell me how I can help you..." style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 15px; resize: vertical; transition: border-color 0.2s; font-family: inherit;" onfocus="this.style.borderColor='{% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}#667eea{% endif %}'" onblur="this.style.borderColor='#e5e7eb'"></textarea>
                </div>
                
                <button type="submit" id="contactSubmitBtn" style="width: 100%; padding: 16px; background: {% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}linear-gradient(135deg, #667eea, #764ba2){% endif %}; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    Send Message üì§
                </button>
                
                <p style="font-size: 12px; color: #9ca3af; text-align: center; margin-top: 15px;">
                    Your information is secure and will only be used to contact you about your inquiry.
                </p>
            </form>
            
            <!-- Success Message (hidden by default) -->
            <div id="contactSuccessMessage" style="display: none; text-align: center; padding: 30px;">
                <div style="width: 80px; height: 80px; background: #d1fae5; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 40px;">‚úÖ</div>
                <h3 style="font-size: 24px; font-weight: 700; color: #065f46; margin-bottom: 10px;">Message Sent!</h3>
                <p style="color: #666; font-size: 16px; line-height: 1.6;">Thanks for reaching out! {% if agent %}{{ agent.name }}{% else %}I{% endif %} will get back to you as soon as possible.</p>
                <button onclick="closeContactModal()" style="margin-top: 25px; padding: 12px 32px; background: {% if agent and agent.brand_primary_color %}{{ agent.brand_primary_color }}{% else %}#667eea{% endif %}; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Close</button>
            </div>
        </div>
    </div>

    <!-- AI Chatbot Widget -->
    <div id="chatWidget" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
        <!-- Chat Button (Floating) -->
        <button id="chatButton" onclick="toggleChat()" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4); cursor: pointer; font-size: 24px; display: flex; align-items: center; justify-content: center; transition: transform 0.3s;">
            üí¨
        </button>

        <!-- Chat Window -->
        <div id="chatWindow" style="display: none; position: fixed; bottom: 90px; right: 20px; width: 380px; height: 500px; background: white; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); flex-direction: column; overflow: hidden;">
            <!-- Chat Header -->
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    {% if agent and agent.headshot_url %}
                    <img src="{{ agent.headshot_url }}" alt="{{ agent.name }}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid white;">
                    {% else %}
                    <div style="width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.3); display: flex; align-items: center; justify-content: center; font-size: 20px;">üë§</div>
                    {% endif %}
                    <div>
                        <div style="font-weight: 700; font-size: 16px;">{% if agent %}{{ agent.name }}{% else %}AI Assistant{% endif %}</div>
                        <div style="font-size: 12px; opacity: 0.9;">Typically replies instantly</div>
                    </div>
                </div>
                <button onclick="toggleChat()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; line-height: 1;">√ó</button>
            </div>

            <!-- Chat Messages -->
            <div id="chatMessages" style="flex: 1; overflow-y: auto; padding: 20px; background: #f9fafb;">
                <!-- Welcome Message -->
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0;">
                        ü§ñ
                    </div>
                    <div style="background: white; padding: 12px 16px; border-radius: 12px; max-width: 80%; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                        <p style="margin: 0; color: #374151; font-size: 14px; line-height: 1.5;">
                            üëã Hi! I'm {% if agent %}{{ agent.name }}'s{% else %}the{% endif %} AI assistant.<br><br>
                            I can help you find homes, get instant valuations, or answer market questions.<br><br>
                            <strong>What brings you here today?</strong>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Chat Input -->
            <div style="padding: 15px; background: white; border-top: 1px solid #e5e7eb;">
                <form id="chatForm" onsubmit="sendMessage(event)" style="display: flex; gap: 10px;">
                    <input type="text" id="chatInput" placeholder="Type your message..." required style="flex: 1; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;" autocomplete="off">
                    <button type="submit" id="chatSendBtn" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        Send
                    </button>
                </form>
                <p style="font-size: 11px; color: #9ca3af; margin-top: 8px; text-align: center;">
                    Powered by AI ‚Ä¢ <span id="typingIndicator" style="display: none;">AI is typing...</span>
                </p>
            </div>
        </div>
    </div>

    <style>
        #chatButton:hover {
            transform: scale(1.1);
        }
        
        #chatMessages::-webkit-scrollbar {
            width: 6px;
        }
        
        #chatMessages::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 3px;
        }
        
        @media (max-width: 480px) {
            #chatWindow {
                width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
                bottom: 90px;
            }
        }
    </style>

    <script>
        let chatOpen = false;
        let sessionId = Math.random().toString(36).substring(7);
        
        function toggleChat() {
            chatOpen = !chatOpen;
            const chatWindow = document.getElementById('chatWindow');
            const chatButton = document.getElementById('chatButton');
            
            if (chatOpen) {
                chatWindow.style.display = 'flex';
                chatButton.textContent = '‚úï';
                chatButton.style.transform = 'rotate(90deg)';
                document.getElementById('chatInput').focus();
            } else {
                chatWindow.style.display = 'none';
                chatButton.textContent = 'üí¨';
                chatButton.style.transform = 'rotate(0deg)';
            }
        }
        
        function addMessage(message, isUser = false) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            
            if (isUser) {
                // User message (right side, blue)
                messageDiv.style.cssText = 'display: flex; justify-content: flex-end; margin-bottom: 15px;';
                messageDiv.innerHTML = `
                    <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 12px 16px; border-radius: 12px; max-width: 80%; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                        <p style="margin: 0; font-size: 14px; line-height: 1.5;">${message}</p>
                    </div>
                `;
            } else {
                // AI message (left side, white)
                messageDiv.style.cssText = 'display: flex; gap: 10px; margin-bottom: 15px;';
                messageDiv.innerHTML = `
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0;">
                        ü§ñ
                    </div>
                    <div style="background: white; padding: 12px 16px; border-radius: 12px; max-width: 80%; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                        <p style="margin: 0; color: #374151; font-size: 14px; line-height: 1.5;">${message}</p>
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        async function sendMessage(event) {
            event.preventDefault();
            
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('chatSendBtn');
            const typingIndicator = document.getElementById('typingIndicator');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addMessage(message, true);
            input.value = '';
            sendBtn.disabled = true;
            typingIndicator.style.display = 'inline';
            
            try {
                const response = await fetch('/api/v1/chat/message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        session_id: sessionId,
                        agent_slug: '{% if agent %}{{ agent.slug }}{% endif %}'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Add AI response
                    addMessage(data.response);
                    
                    // Check if lead was captured
                    if (data.lead_captured) {
                        console.log('‚úÖ Lead info captured!');
                        // Add subtle success indicator
                        setTimeout(() => {
                            const successMsg = document.createElement('div');
                            successMsg.style.cssText = 'text-align: center; padding: 8px; background: #d1fae5; color: #065f46; border-radius: 8px; font-size: 12px; margin: 10px 0;';
                            successMsg.textContent = '‚úÖ Got it! Your info has been saved.';
                            document.getElementById('chatMessages').appendChild(successMsg);
                            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
                        }, 500);
                    }
                } else {
                    addMessage("I'm having trouble connecting right now. Please try calling {% if agent and agent.phone %}{{ agent.phone }}{% else %}us{% endif %} directly!");
                }
            } catch (error) {
                console.error('Chat error:', error);
                addMessage("Sorry, I'm having connection issues. Please refresh and try again, or call {% if agent and agent.phone %}{{ agent.phone }}{% else %}us{% endif %}!");
            } finally {
                sendBtn.disabled = false;
                typingIndicator.style.display = 'none';
                input.focus();
            }
        }
        
        // Auto-open chat if query param present
        if (window.location.search.includes('chat=open')) {
            setTimeout(() => toggleChat(), 500);
        }
        
        // Contact Form Functions
        function openContactModal() {
            const modal = document.getElementById('contactModal');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function closeContactModal() {
            const modal = document.getElementById('contactModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // Reset form and show form again (hide success message)
            document.getElementById('contactForm').reset();
            document.getElementById('contactForm').style.display = 'block';
            document.getElementById('contactSuccessMessage').style.display = 'none';
        }
        
        // Close modal when clicking outside
        document.getElementById('contactModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeContactModal();
            }
        });
        
        async function submitContactForm(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('contactSubmitBtn');
            const originalText = submitBtn.textContent;
            
            // Disable button and show loading state
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sending...';
            
            // Get form values
            const formData = {
                full_name: document.getElementById('contact_name').value.trim(),
                email: document.getElementById('contact_email').value.trim(),
                phone: document.getElementById('contact_phone').value.trim() || null,
                lead_type: 'contact_form',
                message: document.getElementById('contact_message').value.trim(),
                metadata: {
                    form_type: 'contact_modal',
                    page: window.location.pathname,
                    hostname: window.location.hostname
                }
            };
            
            console.log('Submitting contact form:', formData);
            
            try {
                const response = await fetch('/api/v1/leads/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                console.log('Response status:', response.status);
                
                // Try to parse response as JSON
                let data;
                try {
                    data = await response.json();
                    console.log('Response data:', data);
                } catch (parseError) {
                    console.error('Failed to parse response:', parseError);
                    throw new Error('Invalid response from server');
                }
                
                if (response.ok) {
                    // Hide form and show success message
                    document.getElementById('contactForm').style.display = 'none';
                    document.getElementById('contactSuccessMessage').style.display = 'block';
                    
                    // Track conversion (if analytics present)
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'generate_lead', {
                            'event_category': 'Contact Form',
                            'event_label': 'Contact Form Submission'
                        });
                    }
                } else {
                    // Server returned an error
                    const errorMsg = data.detail || 'Unknown error occurred';
                    console.error('Server error:', errorMsg);
                    alert('Error: ' + errorMsg + '\n\nPlease try calling {% if agent and agent.phone %}{{ agent.phone }}{% else %}us{% endif %} directly.');
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            } catch (error) {
                console.error('Contact form error:', error);
                console.error('Error details:', error.message, error.stack);
                alert('Sorry, there was a connection error: ' + error.message + '\n\nPlease try again or call {% if agent and agent.phone %}{{ agent.phone }}{% else %}us{% endif %} directly.');
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }
        
        // Auto-open contact form if query param present
        if (window.location.search.includes('contact=open')) {
            setTimeout(() => openContactModal(), 500);
        }
    </script>
</body>
</html>

